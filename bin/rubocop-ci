#!/bin/bash
# git diff-tree -r --no-commit-id --name-only head origin/develop | xargs rubocop

set -e

ALLOWED_WARNINGS=0
warning_count=`git diff-tree -r --no-commit-id --name-only head origin/develop | xargs rubocop --format simple | grep "offenses detected\|offense detected" | cut -d " " -f4`

if [ $warning_count -gt $ALLOWED_WARNINGS ]
then
  echo -e "❌ $warning_count outstanding rubocop warning(s): "
  echo -e "Try running 'git diff-tree -r --no-commit-id --name-only head origin/develop | xargs rubocop -a' to autocorrect any auto-correctable errors"
  exit 1
else
  echo "✅Clean code! No outstanding rubocop warnings introduced in changed files"
  echo "✅Great job ಠ.ಠ"
  exit 0
fi
